<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head th:replace="~{fragments/footer :: head('Préstamos Vencidos')}">
    <title>Préstamos Vencidos - BiblioTech</title>
</head>
<body>
    <div class="wrapper">
        <!-- Sidebar -->
        <div th:replace="~{fragments/sidebar :: sidebar}"></div>
        
        <!-- Contenido Principal -->
        <div class="main-content">
            <!-- Header -->
            <header th:replace="~{fragments/header :: header}" th:with="pageTitle=${titulo}"></header>
            
            <!-- Contenido de la Página -->
            <div class="page-content">
                <!-- Cabecera del Reporte -->
                <div class="card-custom card mb-4">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h4 class="text-danger mb-2">
                                    <i class="bi bi-exclamation-triangle me-2"></i>
                                    <span th:text="${titulo}">Reporte</span>
                                </h4>
                                <p class="text-muted mb-0">
                                    Lista de préstamos que han superado su fecha de devolución esperada
                                </p>
                            </div>
                            <div class="col-md-4 text-end">
                                <div class="fs-1 fw-bold text-danger" th:text="${totalVencidos}">0</div>
                                <small class="text-muted">préstamos vencidos</small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tabla de Préstamos Vencidos -->
                <div class="table-container">
                    <div class="table-header">
                        <h5><i class="bi bi-table me-2"></i>Detalle de Préstamos Vencidos</h5>
                        <a th:href="@{/reportes}" class="btn btn-outline-secondary btn-sm">
                            <i class="bi bi-arrow-left me-1"></i>Volver
                        </a>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-custom mb-0">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Libro</th>
                                    <th>Cliente</th>
                                    <th>DNI</th>
                                    <th>Fecha Préstamo</th>
                                    <th>Fecha Esperada</th>
                                    <th class="text-center">Días Retraso</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="prestamo : ${prestamos}">
                                    <td><code th:text="'#' + ${prestamo.id}">#1</code></td>
                                    <td>
                                        <a th:href="@{/libros/ver/{id}(id=${prestamo.idLibro})}" 
                                           class="text-decoration-none"
                                           th:text="${prestamo.tituloLibro}">Libro</a>
                                    </td>
                                    <td>
                                        <a th:href="@{/clientes/ver/{id}(id=${prestamo.idCliente})}" 
                                           class="text-decoration-none"
                                           th:text="${prestamo.nombreCompletoCliente}">Cliente</a>
                                    </td>
                                    <td><code th:text="${prestamo.dniCliente}">DNI</code></td>
                                    <td th:text="${#temporals.format(prestamo.fechaPrestamo, 'dd/MM/yyyy')}">01/01/2024</td>
                                    <td th:text="${#temporals.format(prestamo.fechaDevolucionEsperada, 'dd/MM/yyyy')}">15/01/2024</td>
                                    <td class="text-center">
                                        <span class="badge bg-danger" th:text="${prestamo.diasRetraso} + ' días'">0 días</span>
                                    </td>
                                    <td>
                                        <a th:href="@{/prestamos/devolver/{id}(id=${prestamo.id})}" 
                                           class="btn btn-sm btn-success">
                                            <i class="bi bi-check-lg me-1"></i>Devolver
                                        </a>
                                    </td>
                                </tr>
                                <tr th:if="${#lists.isEmpty(prestamos)}">
                                    <td colspan="8" class="text-center py-5">
                                        <i class="bi bi-emoji-smile text-success" style="font-size: 3rem;"></i>
                                        <h5 class="mt-3 text-success">¡Excelente!</h5>
                                        <p class="text-muted">No hay préstamos vencidos en este momento</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <div th:replace="~{fragments/footer :: scripts}"></div>
</body>
</html>
